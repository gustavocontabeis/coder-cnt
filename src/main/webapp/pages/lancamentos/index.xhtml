<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:p="http://primefaces.org/ui" xmlns:cc="http://java.sun.com/jsf/composite">

<ui:composition template="/pages/templates/#{configManagedBean.template}.xhtml">

	<ui:define name="pageTitle">..:: Cadastro de Lan√ßamentos ::..</ui:define>

	<ui:define name="body">
		<p:growl />
		<h:form id="lancamento">
			<p:focus />
			<div class="ui-fluid">
				<p:panelGrid id="pgLancamento" columns="2" layout="grid" columnClasses="ui-grid-col-2, ui-grid-col-10">

					<p:outputLabel for="id" value="#{labels['lancamento.id']}" />
					<p:column>
						<h:outputText id="id" value="#{lancamentoManagedBean.lancamento.id}" styleClass="ui-widget">
							<f:convertNumber type="number" integerOnly="true" groupingUsed="false" />
						</h:outputText>
						<h:inputHidden id="idHidden" value="#{lancamentoManagedBean.lancamento.id}" />
					</p:column>

					<p:outputLabel for="date" value="#{labels['lancamento.date']}" />
					<p:calendar id="date" value="#{lancamentoManagedBean.lancamento.date}" required="true" size="10" maxlength="10" pattern="dd/MM/yyyy" locale="pt" />

					<p:outputLabel for="exercicio" value="#{labels['lancamento.exercicio']}" />
					<p:selectOneMenu id="exercicio" value="#{lancamentoManagedBean.lancamento.exercicio}" required="true">
						<f:selectItem itemLabel="[Selecione]" />
						<f:selectItems value="#{lancamentoManagedBean.exercicios}" var="obj" itemValue="#{obj}" itemLabel="#{obj.empresa.razaoSocial} - #{obj.ano}" />
						<f:converter converterId="baseEntityConverter" />
						<f:attribute name="tipo" value="br.com.cnt.model.entity.balanco.Exercicio" />
						<f:attribute name="list" value="#{lancamentoManagedBean.exercicios}" />
					</p:selectOneMenu>

					<p:outputLabel for="debito" value="#{labels['lancamento.debito']}" />
					<p:selectOneMenu id="debito" value="#{lancamentoManagedBean.lancamento.debito}" required="false">
						<f:selectItem itemLabel="[Selecione]" />
						<f:selectItems value="#{lancamentoManagedBean.contas}" var="obj" itemValue="#{obj}" itemLabel="#{obj.estrutura} - #{obj.nome}" itemDisabled="#{obj.contaTipo == 'SINTETICA'}" />
						<f:converter converterId="baseEntityConverter" />
						<f:attribute name="tipo" value="br.com.cnt.model.entity.balanco.Conta" />
						<f:attribute name="list" value="#{lancamentoManagedBean.contas}" />
					</p:selectOneMenu>

					<p:outputLabel for="credito" value="#{labels['lancamento.credito']}" />
					<p:selectOneMenu id="credito" value="#{lancamentoManagedBean.lancamento.credito}" required="false">
						<f:selectItem itemLabel="[Selecione]" />
						<f:selectItems value="#{lancamentoManagedBean.popularComboConta}" var="obj" itemValue="#{obj}" itemLabel="#{obj.estrutura} - #{obj.nome}" itemDisabled="#{obj.contaTipo == 'SINTETICA'}" />
						<f:converter converterId="baseEntityConverter" />
						<f:attribute name="tipo" value="br.com.cnt.model.entity.balanco.Conta" />
						<f:attribute name="list" value="#{lancamentoManagedBean.contas}" />
					</p:selectOneMenu>

					<p:outputLabel for="valor" value="#{labels['lancamento.valor']}" />
					<p:inputText id="valor" value="#{lancamentoManagedBean.lancamento.valor}" required="true" dir="RTL">
						<p:keyFilter regEx="/[\d\-,]/" />
						<f:convertNumber type="number" minFractionDigits="2" />
						<p:ajax event="change" update="@this" />
					</p:inputText>

					<p:outputLabel for="historico" value="#{labels['lancamento.historico']}" />
					<p:inputTextarea id="historico" value="#{lancamentoManagedBean.lancamento.historico}" required="true" rows="5" cols="100" />

					<p:outputLabel for="lancamentoTipo" value="#{labels['lancamento.lancamentoTipo']}" />
					<p:selectOneMenu id="lancamentoTipo" value="#{lancamentoManagedBean.lancamento.lancamentoTipo}" required="false">
						<f:selectItem itemLabel="[Selecione]" />
						<f:selectItems value="#{lancamentoManagedBean.popularComboLancamentoTipo}" var="obj" itemValue="#{obj}" />
					</p:selectOneMenu>

				</p:panelGrid>
			</div>
			<p:toolbar>
				<p:toolbarGroup>
					<p:commandButton actionListener="#{lancamentoManagedBean.novo}" value="Novo" ajax="false" disabled="#{empty lancamentoManagedBean.lancamento.id}" />
					<p:commandButton actionListener="#{lancamentoManagedBean.salvar}" value="Salvar" update="@all" />
					<p:commandButton actionListener="#{lancamentoManagedBean.excluir}" value="Excluir" update="@all" disabled="#{empty lancamentoManagedBean.lancamento.id}" onstart="return confirm('Tem certesa que deseja excluir?')" />
					<p:commandButton actionListener="#{lancamentoManagedBean.clonar}" value="Clonar" update="@form" disabled="#{empty lancamentoManagedBean.lancamento.id}" />
				</p:toolbarGroup>
			</p:toolbar>
		</h:form>
		<h:form id="lancamentoList">
			<p:dataTable var="item" value="#{lancamentoManagedBean.model}" emptyMessage="#{labels['cfg.table.empty']}" 
						paginator="true" rows="#{labels['cfg.table.rows']}" paginatorTemplate="#{labels['cfg.table.template']}"
				rowsPerPageTemplate="#{labels['cfg.table.template.pages']}" paginatorPosition="#{labels['cfg.table.template.paginatorPosition']}" 
				selectionMode="single" 
				selection="#{lancamentoManagedBean.lancamento}" rowKey="#{item.id}" lazy="true" reflow="true">

				<p:ajax event="rowSelect" update="@all" reflow="true" />

				<p:column headerText="#{labels['lancamento.id']}" width="80">
					<h:outputText value="#{item.id}" />
				</p:column>

				<p:column headerText="#{labels['lancamento.exercicio']}">
					<h:outputText value="#{item.exercicio.empresa.razaoSocial}-#{item.exercicio.ano}" />
				</p:column>

				<p:column headerText="#{labels['lancamento.date']}">
					<h:outputText value="#{item.date}">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>

				<p:column headerText="#{labels['lancamento.debito']}">
					<h:outputText value="#{item.debito.estrutura}-#{item.debito.nome}" />
				</p:column>

				<p:column headerText="#{labels['lancamento.credito']}">
					<h:outputText value="#{item.credito.estrutura}-#{item.credito.nome}" />
				</p:column>

				<p:column headerText="#{labels['lancamento.historico']}">
					<h:outputText value="#{item.historico}" />
				</p:column>

				<p:column headerText="#{labels['lancamento.lancamentoPrincipal']}">
					<h:outputText value="#{item.lancamentoPrincipal}" />
				</p:column>

				<p:column headerText="#{labels['lancamento.lancamentoTipo']}">
					<h:outputText value="#{item.lancamentoTipo}" />
				</p:column>

				<p:column headerText="#{labels['lancamento.valor']}" styleClass="numerico">
					<h:outputText value="#{item.valor}">
						<f:convertNumber type="number" minFractionDigits="2" />
					</h:outputText>
				</p:column>

			</p:dataTable>
		</h:form>
	</ui:define>

</ui:composition>
</html>